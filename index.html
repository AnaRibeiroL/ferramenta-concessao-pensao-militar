<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Ferramenta de Concess√£o de Pens√£o Militar</title>

  <!-- Fonte moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- √çcones modernos com Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Estilos visuais -->
  <link rel="stylesheet" href="style.css">

  <!-- Estilo embutido para altura total e modo escuro -->
  <style>
    /* ... (todo o CSS est√° aqui, mantido sem altera√ß√µes) ... */
  </style>
</head>
<body>

  <!-- üî≤ Container principal -->
  <div class="conteudo-principal">

    <!-- üî∑ Faixa superior com logos e bot√£o de modo escuro -->
    <div class="faixa-superior">
      <img src="imgdap.png" alt="Logo DAP" class="logo-dap">
      <h1 class="titulo-principal" id="tituloPrincipal">Ferramenta de Concess√£o da Pens√£o Militar</h1>
      <img src="imgDGP.png" alt="Logo DGP" class="logo-dgp">
      <button id="darkModeToggle" title="Alternar modo escuro" style="background:none;border:none;color:white;font-size:18px;cursor:pointer;">
        <i class="fas fa-moon"></i>
      </button>
    </div>

    <!-- üß≠ Menu de navega√ß√£o -->
    <div class="menu-container">
      <div class="botoes">

    <!--  Bot√£o Menu Inicial -->    
        <button class="menu-btn active" id="btnMenuInicial" onclick="navegar('menuInicial', this)">
          <i class="fas fa-home"></i> Menu Inicial
        </button>

    <!--  Bot√£o C√°lculo da Pens√£o Militar -->        
        <button class="menu-btn" onclick="navegar('calculoPensao', this)">
          <i class="fas fa-calculator"></i> C√°lculo da Pens√£o Militar
        </button>

    <!--  Bot√£o Cadastro dos Requerentes -->  
        <button class="menu-btn" onclick="navegar('cadastrorequerentes', this)">
          <i class="fas fa-user-plus"></i> Cadastro dos Requerentes
        </button>

    <!--  Bot√£o Gerar Documentos: An√°lisar se ser√° vi√°vel at√© o fim do Desenvolvimento -->     
        <button class="menu-btn" onclick="navegar('documentosWord', this)">
          <i class="fas fa-file-word"></i> Gerar Documentos
        </button>
      </div>
    </div>

    <!-- ‚è≥ Loader de transi√ß√£o -->
    <div id="loader" class="loader"></div>

    <!-- üìÑ Aba: Menu Inicial -->
    <div id="menuInicialAba" class="aba visivel">
      <div class="faixa-superior-calculo">
        <h2 class="titulo-calculo">Ferramenta de Concess√£o da Pens√£o Militar</h2>
      </div>

    <!-- üìÑ Aba: Menu Inicial ‚Äì Painel de apresenta√ß√£o e orienta√ß√£o inicial da aplica√ß√£o -->
      <div class="conteudo-calculo">
        Bem-vindo √† ferramenta de concess√£o da pens√£o militar!
      </div>
    </div>

    <!-- üìÑ Aba: C√°lculo da Pens√£o ‚Äì Se√ß√£o respons√°vel c√°lculo do valor da pens√£o e defini√ß√£o das cotas individuais dos requerentes -->
    <div id="calculoPensaoAba" class="aba">
      <div class="faixa-superior-calculo">
        <h2 class="titulo-calculo">C√°lculo e Distribui√ß√£o da Pens√£o Militar</h2>
      </div>
      <div class="conteudo-calculo">
        <button id="toggleLinhasBtn" class="btn-toggle-linhas exibir">
          <i class="fas fa-eye"></i> Exibir Informa√ß√µes do C√°lculo da Pens√£o Militar
        </button>



        <div class="campo-flutuante" id="campoPosto">
          <select id="postoSelect" required>
            <option value="" disabled selected hidden></option>
            <option value="General de Ex√©rcito">General de Ex√©rcito</option>
            <option value="General de Divis√£o">General de Divis√£o</option>
            <option value="General de Brigada">General de Brigada</option>
            <option value="Coronel">Coronel</option>
            <option value="Tenente-Coronel">Tenente-Coronel</option>
            <option value="Major">Major</option>
            <option value="Capit√£o">Capit√£o</option>
            <option value="Tenente">Tenente</option>
            <option value="Sargento">Sargento</option>
            <option value="Cabo">Cabo</option>
            <option value="Soldado">Soldado</option>
          </select>
          <label for="postoSelect">Selecione o Posto/Gradua√ß√£o Real</label>
        </div>

        <div id="linhasCalculo" class="linhas-calculo" style="display: none;">
          <div class="linha-calculo">Linha 1: Exemplo de c√°lculo</div>
          <div class="linha-calculo">Linha 2: Exemplo de c√°lculo</div>
          <div class="linha-calculo">Linha 3: Exemplo de c√°lculo</div>
        </div>
      </div>
    </div>
     <!-- üìÑ Aba: Cadastro dos Requerentes -->
    <div id="cadastrorequerentesAba" class="aba">
      <div class="faixa-superior-calculo">
        <h2 class="titulo-calculo">Cadastro dos Requerentes da Pens√£o Militar</h2>
      </div>
      <div class="conteudo-calculo">
        <!-- √Årea din√¢mica onde os blocos de requerentes ser√£o inseridos -->
        <div id="listaRequerentes"></div>

        <!-- Bot√µes de a√ß√£o -->
        <button onclick="adicionarRequerente()">Adicionar Requerente</button>
        <button onclick="gerarDocumentosWord()">Gerar Documentos Word</button>
      </div>
    </div>

    <!-- üìÑ Aba: Documentos Word -->
    <div id="documentosWordAba" class="aba">
      <div class="faixa-superior-calculo">
        <h2 class="titulo-calculo">Documentos Obrigat√≥rios para Concess√£o da Pens√£o Militar</h2>
      </div>
      <div class="conteudo-calculo">
        <!-- Conte√∫do futuro -->
        <p>Em breve voc√™ poder√° visualizar e baixar os documentos gerados automaticamente.</p>
      </div>
    </div>
  </div> <!-- fim da div conteudo-principal -->

  <!-- üìç Rodap√© institucional -->
  <div class="rodape">
    <span>Vers√£o 1.0 ‚Ä¢ Desenvolvido por 3¬∞ Sgt Ana Cristina ‚Ä¢ ¬© 2025</span><br>
    <small>Diretoria de Assist√™ncia ao Pessoal</small>
    <div class="rodape-links">
      <a href="#sobre">Sobre</a> |
      <a href="#privacidade">Pol√≠tica de Privacidade</a> |
      <a href="#termos">Termos de Uso</a> |
      <a href="#contato">Contato</a>
    </div>
  </div>
    <!-- üß† Script funcional -->
  <script>
    // üß≠ Navega√ß√£o entre abas com transi√ß√£o e destaque
    function navegar(abaId, botaoClicado) {
      const loader = document.getElementById("loader");
      loader.style.display = "block";

      setTimeout(() => {
        loader.style.display = "none";

        document.querySelectorAll(".aba").forEach((aba) => {
          aba.classList.remove("visivel");
          aba.style.display = "none";
        });

        const abaSelecionada = document.getElementById(abaId + "Aba");
        if (abaSelecionada) {
          abaSelecionada.style.display = "block";
          setTimeout(() => {
            abaSelecionada.classList.add("visivel");
          }, 10);
        }

        const tituloPrincipal = document.getElementById("tituloPrincipal");
        switch (abaId) {
          case "menuInicial":
            tituloPrincipal.textContent = "Ferramenta de Concess√£o de Pens√£o Militar";
            break;
          case "calculoPensao":
            tituloPrincipal.textContent = "C√°lculo e Distribui√ß√£o da Pens√£o Militar";
            break;
          case "cadastrorequerentes":
            tituloPrincipal.textContent = "Cadastro dos Requerentes da Pens√£o Militar";
            break;
          case "documentosWord":
            tituloPrincipal.textContent = "Documentos Obrigat√≥rios da Gera√ß√£o do Direito √† Pens√£o Militar";
            break;
        }

        document.querySelectorAll(".menu-btn").forEach((btn) => {
          btn.classList.remove("active");
          btn.style.backgroundColor = "#FFFFFF";
        });

        botaoClicado.classList.add("active");
        botaoClicado.style.backgroundColor = "#D0E3FA";
      }, 400);
    }

    // üöÄ Inicializa√ß√£o ao carregar a p√°gina
    document.addEventListener("DOMContentLoaded", () => {
      const toggleBtn = document.getElementById("toggleLinhasBtn");
      const linhas = document.getElementById("linhasCalculo");
      const campoPosto = document.getElementById("campoPosto");
      const darkToggle = document.getElementById("darkModeToggle");
      const darkIcon = darkToggle?.querySelector("i");

      let visivel = false;

      // üîò Altern√¢ncia de exibi√ß√£o das informa√ß√µes
      if (toggleBtn && linhas && campoPosto) {
        toggleBtn.addEventListener("click", () => {
          visivel = !visivel;
          linhas.style.display = visivel ? "block" : "none";
          campoPosto.style.display = visivel ? "block" : "none";

          toggleBtn.classList.toggle("exibir", !visivel);
          toggleBtn.classList.toggle("ocultar", visivel);
          toggleBtn.innerHTML = visivel
            ? `<i class="fas fa-eye-slash"></i> Ocultar Informa√ß√µes do C√°lculo da Pens√£o Militar`
            : `<i class="fas fa-eye"></i> Exibir Informa√ß√µes do C√°lculo da Pens√£o Militar`;
        });

        toggleBtn.classList.add("exibir");
        campoPosto.style.display = "none";
      }

      // üåô Modo escuro persistente
      const modoSalvo = localStorage.getItem("modoEscuro");
      if (modoSalvo === "ativo") {
        document.body.classList.add("dark-mode");
        if (darkIcon) {
          darkIcon.classList.remove("fa-moon");
          darkIcon.classList.add("fa-sun");
        }
      }

      if (darkToggle && darkIcon) {
        darkToggle.addEventListener("click", () => {
          document.body.classList.toggle("dark-mode");
          const modoAtivo = document.body.classList.contains("dark-mode");

          darkIcon.classList.toggle("fa-moon", !modoAtivo);
          darkIcon.classList.toggle("fa-sun", modoAtivo);
          localStorage.setItem("modoEscuro", modoAtivo ? "ativo" : "inativo");
        });
      }

      // üîÑ Restaura campos salvos
      restaurarRequerentes();
    });

    // ‚ûï Adiciona um novo bloco de requerente
    function adicionarRequerente() {
      const container = document.getElementById("listaRequerentes");
      const index = container.children.length + 1;

      const div = document.createElement("div");
      div.className = "requerente-bloco";
      div.innerHTML = `
        <h4>Requerente ${index}</h4>
        <input type="text" id="nome${index}" placeholder="Nome do requerente">
        <input type="text" id="cpf${index}" placeholder="CPF do requerente">
      `;
      container.appendChild(div);

      salvarCampoTemporariamente(`nome${index}`);
      salvarCampoTemporariamente(`cpf${index}`);
    }

    // üíæ Salva dados localmente durante a sess√£o
    function salvarCampoTemporariamente(campoId) {
      const campo = document.getElementById(campoId);
      if (!campo) return;

      campo.addEventListener("input", () => {
        sessionStorage.setItem(campoId, campo.value);
      });

      const valorSalvo = sessionStorage.getItem(campoId);
      if (valorSalvo) {
        campo.value = valorSalvo;
      }
    }

    // üîÑ Restaura campos salvos ao recarregar
    function restaurarRequerentes() {
      const container = document.getElementById("listaRequerentes");
      const camposSalvos = Object.keys(sessionStorage).filter((key) =>
        key.startsWith("nome")
      );

      camposSalvos.forEach((key) => {
        const index = key.replace("nome", "");
        const div = document.createElement("div");
        div.className = "requerente-bloco";
        div.innerHTML = `
          <h4>Requerente ${index}</h4>
          <input type="text" id="nome${index}" placeholder="Nome do requerente">
          <input type="text" id="cpf${index}" placeholder="CPF do requerente">
        `;
        container.appendChild(div);

        salvarCampoTemporariamente(`nome${index}`);
        salvarCampoTemporariamente(`cpf${index}`);
      });
    }

    // üìÑ Gera documentos Word com base nos dados dos requerentes
    function gerarDocumentosWord() {
      const container = document.getElementById("listaRequerentes");
      const blocos = container.querySelectorAll(".requerente-bloco");

      if (blocos.length === 0) {
        alert("Nenhum requerente cadastrado.");
        return;
      }

      blocos.forEach((bloco, i) => {
        const nome = bloco.querySelector(`#nome${i + 1}`)?.value || "";
        const cpf = bloco.querySelector(`#cpf${i + 1}`)?.value || "";

        if (!nome.trim() || !cpf.trim()) {
          alert(`Requerente ${i + 1} est√° incompleto. Preencha todos os campos.`);
          return;
        }

        exportarParaWord({ nome, cpf });
      });
    }

    // üì§ Exporta documento Word com base no modelo
    function exportarParaWord(requerente) {
      fetch("modelo-parecer.docx")
        .then((res) => res.arrayBuffer())
        .then((content) => {
          const zip = new PizZip(content);
          const doc = new window.docxtemplater(zip, {
            paragraphLoop: true,
            linebreaks: true,
          });

          doc.render({
            nome: requerente.nome,
            cpf: requerente.cpf,
            data: new Date().toLocaleDateString("pt-BR"),
          });

          const nomeArquivo = requerente.nome
            .replace(/\s+/g, "_")
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "");

          const blob = doc.getZip().generate({
            type: "blob",
            mimeType:
              "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
          });

          saveAs(blob, `Parecer_${nomeArquivo}.docx`);
        })
        .catch((error) => {
          console.error("Erro ao gerar documento:", error);
          alert("Ocorreu um erro ao gerar o documento Word.");
        });
    }
  </script>

  <!-- üì¶ Bibliotecas externas para gera√ß√£o de documentos -->
  <script src="https://unpkg.com/pizzip@3.0.6/dist/pizzip.min.js"></script>
  <script src="https://unpkg.com/docxtemplater@3.29.0/build/docxtemplater.js"></script>
  <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
</body>
</html>
